### HTTP 메서드의 속성

HTTP 메서드의 속성으로는 크게 3가지인 안전(Safe), 멱등(Idempotent), 캐시 가능(Cacheable) 이 있다.

## 안전성

HTTP 메서드의 안전성이란 보얀 취약성을 말하는것이 아닌 호출해도 리소스가 변경되지 않는 성질을 말한다.

GET 메서드는 단순히 데이터를 조회하는 기능을 수행하기 때문에 리소스를 변경 및 수정하지 않으니 안전한 HTTP 메서드 이다.

## 멱등성(Idempotent)

멱등이라는 단어의 뜻은 수학이나 전산학에서 연산을 여러번 적용하더라도 결과가 달라지지 않는 성질을 의미한다.

HTTP 메서드에서 멱등성이란 동일한 요청을 한번 보내는것과 여러번 연속으로 보내는것이 같은 효과를 가지고, 서버의 상태도 동일하게 남을때 해당 HTTP 메서드가 멱등성을 가진다고 말한다.

### GET의 멱등

GET은 데이터를 한번이나 여러번을 조회하더라도 같은 결과가 조회되므로 안전과 멱등을 동시에 만족하는 메서드이다.

### 멱등적이지 않은 GET 설계

하지만 만약 개발자가 조회수 기능을 추가하면서, 다음과 같이 게시글을 조회하면 동시에 조회수도 올리도록 구현하면 GET 요청을 보낼때마다 서버의 데이터 상태는 매번 바뀌게 된다. 즉, 멱등성을 가지지 않게 된 GET 이 된것이며 HTTP 스펙에 부합하지 않게 API를 구현했다고 볼 수 있다.

### DELETE의 멱등

GET이 단순 조회라면, DELETE는 단순 삭제이다. 따라서 DELETE는 멱등성을 가진다.

DELETE를 처음 요청하면, 서버에서 해당 리소스는 삭제가 된다. 이후 DELETE를 여러번 요청하더라도 해당 리소스는 삭제된 상태 그대로 일 것이니 서버의 상태는 변하지 않는다.

### 멱등적이지 않은 DELETE 설계

DELETE API를 설계할 때는 정확한 식별자를 통해 리소스를 지정해야한다.

예를 들어 게시글을 삭제할때 정확한 게시글 ID 값이 아닌 last 라는 구조로 좀 더 유연하게 서버에서 처리되도록 구현하였다고 가정했을때 이럴 경우 DELETE 요청을 여러번 보내게 되면 매번 마지막 게시글을 삭제하기 때문에 서버의 상태가 변하게 된다.

즉, 멱등성을 가지지 않는것이다.

### POST의 멱등

POST 메서드는 멱등을 만족하지 않는다.

POST 메서드는 서버로 데이터를 전송하여 새로운 자원을 만들기 때문에 요청을 여러번 보내는 경우 매번 새로운 자원이 생겨나 서버의 상태가 변경되기 때문

### 복구 메커니즘에 따져야 하는 멱등성

클라이언트가 서버에게 HTTP 메세지를 전송하였는데, TIMEOUT 과 같은 문제들로 인해 정상적인 응답을 전달받지 못했다고 가정해보자.

정상적인 응답을 받지 못했다면 다시 요청하면 그만이라고 생각하겠지만 여기에 HTTP의 멱등성의 유무가 들어가게 된다.

일반적으로 GET 이나 DELETE 같은 메서드들은 여러 번 호출하여도 응답 결과는 변함이 없기 때문에, 통신 장애 시 똑같은 요청을 재전송하도록 설계해도 문제는 없을 것이다.

하지만 POST 와 같은 멱등하지 않게 설계된 메서드들은 똑같은 요청을 다시 전송할 경우 문제 발생 가능성 요지가 있다.

왜냐하면 통신 장애 이유가 서버 자체가 문제일수도 있고 아니면 인터넷 선이 문제일수도 있기 때문이다.

만일 서버에서는 정상 처리했는데 응답 과정에서 네트워크 문제로 정상적인 응답을 받지 않았다면, POST를 재요청 해버리면 서버 입장에선 처리를 한 번 더 하게 되는 결과를 낳게 된다.

만일 이것이 돈과 관련된 결제와 같은 서비스라면 결제가 중복으로 되는 큰 문제로 직결된다.

따라서 POST 요청 같은 경우 더 큰 문제가 발생할 수 있기 때문에 요청을 또 보내는 것이 아닌 다른 조치를 취할 수 있도록 설계하는 것이 적절할 것이다.

이렇게 복구 매커니즘의 사용 가능 여부에 있어서 HTTP의 멱등적인 속성은 설계의 중심이 되게 된다.

### PUT의 멱등

PUT 메서드는 대상 리소스를 덮어씌워 변경하거나, 대상 리소스가 없다면 새로 추가한다.

따라서 요청을 한번하든 여러번하든 결국 서버의 상태는 같아지니 PUT은 멱등하다.

### PATCH의 멱등

PATCH는 리소스의 부분적인 수정을 할 때 사용된다.

PATCH의 특이한 점은 기본적으로 멱등성을 가지지 않는 메서드인데, 그 구현을 PUT과 동일한 방식으로 할 경우 멱등성을 가지게 되는 특성을 지니고 있다.

즉, PATCH는 멱등하게 설계할 수도 있고, 멱등하지 않도록 설계할 수도 있다.

PUT메서드는 반드시 멱등성을 보장

PATCH메서드는 보장하지 않을 수도 있다.

## 캐시 가능성

캐시 가능성은 응답 결과 리소스를 캐싱해서 효율적으로 사용할 수 있는가에 대한 여부.

하지만 실제로는GET이나 HEAD 정도만 캐시로 이용이 가능하고 POST 와 PATCH 는 지원되지 않는 경우가 일반적이라고 한다.

왜냐하면 브라우저의 캐시를 이용하려면 원본 데이터가 변경되지 않고 유지되어야 하는데, POST, PUT, DELETE, PATCH 는 기본적으로 데이터 변경이 되는 메서드 이기 때문에, 만일 호출로 인해 데이터가 변경되게 되면 원본 데이터 또한 변경되기어 캐시 데이터 불일치 문제가 생기기 때문이다.

반면 GET은 딱 URI만 키로 잡고 캐시하면 되서 간단하다.따라서, GET HEAD 메서드는 캐시가 가능하기 때문에 브라우저에서 리소스를 임시로 보관할 수 있고, 나머지 메서드들은  구현의 복잡성 혹은 유지의 어려움 때문에 캐시를 이용하지 않는다고 생각하면 된다.
