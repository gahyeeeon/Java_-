# 3. 웹 브라우저의 Cookie

쿠키

서버가 사용자의 웹 브라우저에 전송하는 작은 데이터 조각, key=value 형식의 문자열 데이터 묶음

서버와 클라이언트 간의 연결 유지를 구현하기 위해 서로를 인식할 수 있는 식별 데이터가 필요, 그것을 쿠키

세션 관리(Session Management) : 서버 간 일시적인 연결 유지에 이용(로그인)

개인화(Personalization) : 웹사이트에 대한 사용자 선호, 테마 등의 세팅

트래킹(Tracking) : 사용자 행동을 기록하고 분석하는 용도(광고)

클라이언트의 쿠키는 웹브라우저가 관리

**Cookie(요청 헤더)**

HTTP 요청 시 클라이언트에서 서버로 전달하는 쿠키 헤더

서버의 세션 상태를 담은 SessionID 혹은 각종 클라이언트 정보들을 담음

**Set-Cookie(응답 헤더)**

서버에서 클라이언트로 전달하는 쿠키 헤더

클라이언트는 이 정보를 바당으로 쿠키를 만들어 브라우저에 저장

**쿠키의 저장 방식**

쿠키는 key=value형태로 저장되는 문자열로서 여러 개의 데이터를 콤마(,)로 열거하여 저장

쿠키는 유효 기간이나 도메인 등을 설정한 파라미터들을 세미콜론(;)을 통해 열거

**쿠키 생명 주기**

expires와 max-age를 통해 만료일을 설정

expires : 구체적인 날짜를 명시, 만료일이 지나면 쿠키는 삭제

max-age : 쿠키 유효 시간을 명시(초 단위), 만일 0이나 음수로 지정할 경우, 쿠키 삭제

만일 만료 날짜를 생략하면 브라우저 종료 시까지만 유지, 이를 세션 쿠키

만료 날짜를 입력하면 해당 날짜까지 유지, 이를 영속 쿠키

**쿠키 Path**

쿠키에 경로를 설정하면, 해당 페이지 경로에서만 쿠키 사용 접근이 가능

해당 경로의 하위 경로까지 모두 포함, 루트 경로(/)로 설정하면 모든 경로에 쿠키가 유효

path를 입력하지 않으면 루트 경로로 자동 입력

단, 쿠키의 범위를 좁게 잡을 수록 보안에 좋음

**쿠키 Domain**

쿠키에 도메인을 설정하면, 해당 도메인 페이지에서만 쿠키 사용 접근 가능

해당 도메인의 서브 도메인까지 모두 포함

domain=example.org 지정

도메인을 생략하면 현재 문서 기준 도메인으로만 적용

만일 현재 도메인에서 설정한 쿠키를 퍼스트 파티 쿠키(First-party-cookies)

다른 도메인으로 설정된 쿠키를 서드 파티 쿠키(Third-party cookies)

**서드 파티 쿠키(Third-party cookies)**

쿠키 도메인 파라미터를 전혀 다른 도메인으로 설정된 쿠키

구글 애드센스와 같은 스크립트만 등록되어 있다면 여러 개의 사이트에 쿠키 생성 가능

**쿠키 Secure**

활성화 → HTTPS 사용시에만 쿠키 정보 전달

미적용 → HTTP, HTTPS 구분x

**쿠키 HttpOnly**

자바스크립트에서 쿠키 사용 접근 제한

해커가 자바스크립트로 쿠키를 탈취할 수 없어 XSS 공격 방지

**쿠키 SameSite**

SameSite 속성은 서드 파티 쿠키의 보안적 문제를 해결

XSRF, CSRF 공격 방지

요청 도메인과 쿠키 정보 내의 도메인이 다른 크로스 사이트(Cross-Site)로 전송하는 요청에 대해서 제한 둘 수 있음

**SameSite 3가지 속성**

None : 쿠키는 크로스 사이트 요청의 경우에도 항상 전송, 보안적으로 SameSite적용 하지 않은 쿠키

Strict  : 쿠키는 크로스 사이트 요청에는 항상 전송x, 가장 보수적인 정책

Lax : Strict에 비해 상대적으로 느슨한 속성